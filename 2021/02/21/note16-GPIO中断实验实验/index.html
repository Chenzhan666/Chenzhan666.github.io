<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>note16 GPIO中断实验 | CHENZHAN</title><meta name="keywords" content="ARM(MX6U)"><meta name="author" content="Chenzhan666"><meta name="copyright" content="Chenzhan666"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Cortex-A7 中断系统详解基本概念中断向量表中断向量表是一个表，这个表里面存放的是中断向量。中断服务程序的入口地址或存放中断服务程序的首地址成为中断向量，因此中断向量表是一系列中断服务程序入口地址组成的表。这些中断服务程序(函数)在中断向量表中的位置是由半导体厂商定好的，当某个中断被触发以后就会自动跳转到中断向量表中对应的中断服务程序(函数)入口地址处。中断向量表在整个程序的最前面 中断">
<meta property="og:type" content="article">
<meta property="og:title" content="note16 GPIO中断实验">
<meta property="og:url" content="https://chenzhan666.coding.me/2021/02/21/note16-GPIO%E4%B8%AD%E6%96%AD%E5%AE%9E%E9%AA%8C%E5%AE%9E%E9%AA%8C/index.html">
<meta property="og:site_name" content="CHENZHAN">
<meta property="og:description" content="Cortex-A7 中断系统详解基本概念中断向量表中断向量表是一个表，这个表里面存放的是中断向量。中断服务程序的入口地址或存放中断服务程序的首地址成为中断向量，因此中断向量表是一系列中断服务程序入口地址组成的表。这些中断服务程序(函数)在中断向量表中的位置是由半导体厂商定好的，当某个中断被触发以后就会自动跳转到中断向量表中对应的中断服务程序(函数)入口地址处。中断向量表在整个程序的最前面 中断">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i0.hdslb.com/bfs/album/c2e54c69fd83a318261e5b30e13bc8184caf837f.jpg@518w.jpg">
<meta property="article:published_time" content="2021-02-20T17:16:28.000Z">
<meta property="article:modified_time" content="2021-02-26T09:56:49.058Z">
<meta property="article:author" content="Chenzhan666">
<meta property="article:tag" content="ARM(MX6U)">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i0.hdslb.com/bfs/album/c2e54c69fd83a318261e5b30e13bc8184caf837f.jpg@518w.jpg"><link rel="shortcut icon" href="/Personalwebsite/blog/myBlog/img/favicon.png"><link rel="canonical" href="https://chenzhan666.coding.me/2021/02/21/note16-GPIO%E4%B8%AD%E6%96%AD%E5%AE%9E%E9%AA%8C%E5%AE%9E%E9%AA%8C/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/Personalwebsite/blog/myBlog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/Personalwebsite/blog/myBlog/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-02-26 17:56:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/Personalwebsite/blog/myBlog/atom.xml" title="CHENZHAN" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/Personalwebsite/blog/myBlog/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/Personalwebsite/blog/myBlog/archives/"><div class="headline">文章</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/Personalwebsite/blog/myBlog/tags/"><div class="headline">标签</div><div class="length-num">2</div></a></div></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i0.hdslb.com/bfs/album/c2e54c69fd83a318261e5b30e13bc8184caf837f.jpg@518w.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/Personalwebsite/blog/myBlog/">CHENZHAN</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">note16 GPIO中断实验</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-02-20T17:16:28.000Z" title="发表于 2021-02-21 01:16:28">2021-02-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-02-26T09:56:49.058Z" title="更新于 2021-02-26 17:56:49">2021-02-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="note16 GPIO中断实验"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer">

<h1 id="Cortex-A7-中断系统详解"><a href="#Cortex-A7-中断系统详解" class="headerlink" title="Cortex-A7 中断系统详解"></a>Cortex-A7 中断系统详解</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="中断向量表"><a href="#中断向量表" class="headerlink" title="中断向量表"></a>中断向量表</h3><p>中断向量表是一个表，这个表里面存放的是中断向量。中断服务程序的入口地址或存放中断服务程序的首地址成为中断向量，因此中断向量表是一系列中断服务程序入口地址组成的表。这些中断服务程序(函数)在中断向量表中的位置是由半导体厂商定好的，当某个中断被触发以后就会自动跳转到中断向量表中对应的中断服务程序(函数)入口地址处。中断向量表在整个程序的最前面</p>
<p>中断向量表都是链接到代码的最前面，比如一般 ARM 处理器都是从地址 0X00000000 开始执行指令的，那么中断向量表就是从 0X00000000 开始存放的。第一条中断向量，存放的是栈顶指针，接下来是第 2 行复位中断复位函数 Reset_Handler 的入口地址，依次类推</p>
<p>Cortex-A中断向量表有8个中断，其中重点关注IRQ。Cortex-A的中断向量表需要用户自己去定义</p>
<table>
<thead>
<tr>
<th>向量地址</th>
<th>中断类型</th>
<th>中断模式</th>
</tr>
</thead>
<tbody><tr>
<td>0X00</td>
<td>复位中断(Rest)</td>
<td>特权模式(SVC)</td>
</tr>
<tr>
<td>0X04</td>
<td>未定义指令中断(Undefined Instruction)</td>
<td>未定义指令中止模式(Undef)</td>
</tr>
<tr>
<td>0X08</td>
<td>软中断(Software Interrupt,SWI)</td>
<td>特权模式(SVC)</td>
</tr>
<tr>
<td>0X0C</td>
<td>指令预取中止中断(Prefetch Abort)</td>
<td>中止模式</td>
</tr>
<tr>
<td>0X10</td>
<td>数据访问中止中断(Data Abort)</td>
<td>中止模式</td>
</tr>
<tr>
<td>0X14</td>
<td>未使用(Not Used)</td>
<td>未使用</td>
</tr>
<tr>
<td>0X18</td>
<td>IRQ 中断(IRQ Interrupt)</td>
<td>外部中断模式(IRQ)</td>
</tr>
<tr>
<td>0X1C</td>
<td>FIQ 中断(FIQ Interrupt)</td>
<td>快速中断模式(FIQ)</td>
</tr>
</tbody></table>
<p>IRQ 中断， Cortex-A 内核 CPU 的所有外部中 断都属于这个 IQR 中断，当任意一个外部中断发生的时候都会触发 IRQ 中断。在 IRQ 中断服 务函数里面就可以读取指定的寄存器来判断发生的具体是什么中断，进而根据具体的中断做出相应的处理</p>
<ul>
<li>外部中断和 IRQ 中断关系</li>
</ul>
<ol>
<li>复位中断(Rest)，CPU 复位以后就会进入复位中断，我们可以在复位中断服务函数里面 做一些初始化工作，比如初始化 SP 指针、DDR 等等</li>
<li>未定义指令中断(Undefined Instruction)，如果指令不能识别的话就会产生此中断</li>
<li>软中断(Software Interrupt,SWI)，由 SWI 指令引起的中断，Linux 的系统调用会用 SWI 指令来引起软中断，通过软中断来陷入到内核空间</li>
<li>指令预取中止中断(Prefetch Abort)，预取指令的出错的时候会产生此中断</li>
<li>数据访问中止中断(Data Abort)，访问数据出错的时候会产生此中断</li>
<li>IRQ 中断(IRQ Interrupt)，外部中断，前面已经说了，芯片内部的外设中断都会引起此 中断的发生</li>
<li>FIQ 中断(FIQ Interrupt)，快速中断，如果需要快速处理中断的话就可以使用此中</li>
</ol>
<h3 id="中断向量偏移"><a href="#中断向量偏移" class="headerlink" title="中断向量偏移"></a>中断向量偏移</h3><p>一般ARM从0X000000000地址开始运行，对于STM32我们设置连接首地址为0X8000000</p>
<p>如果代码需要从0X8000000开始运行，那么需要告诉一下soc内核。也就是设置中断向量偏移。设置SCB的VTOR寄存器为新的中断向量表起始地址即可</p>
<h3 id="GIC-内嵌向量中断控制器"><a href="#GIC-内嵌向量中断控制器" class="headerlink" title="GIC(内嵌向量中断控制器)"></a>GIC(内嵌向量中断控制器)</h3><p>Holds the physical base address of the memory-mapped GIC registers保存内存映射的GIC寄存器的物理基址（首地址）</p>
<p>NVIC就是中断管理机构。使能和关闭指定的中断、设置中断优先级</p>
<p>GIC 接收众多的外部中断，然后对其进行处理，最终就只通过四个信号 报给 ARM 内核，这四个信号的含义如下</p>
<table>
<thead>
<tr>
<th>VFIQ</th>
<th>虚拟快速FIQ</th>
</tr>
</thead>
<tbody><tr>
<td>VIRQ</td>
<td>虚拟快速IRQ</td>
</tr>
<tr>
<td>FIQ</td>
<td>快速中断IRQ</td>
</tr>
<tr>
<td>IRQ</td>
<td>外部中断IRQ</td>
</tr>
</tbody></table>
<p>左侧部分就是中断源，中间部分就是 GIC 控制器，最右侧就是中断控制器向处理器内核发送中断信息，GIC 将众多的中断源分为分为三类</p>
<ol>
<li>SPI(Shared Peripheral Interrupt),共享中断，顾名思义，所有 Core 共享的中断，这个是最 常见的，那些外部中断都属于 SPI 中断(注意！不是 SPI 总线那个中断) 。比如按键中断、串口 中断等等，这些中断所有的 Core 都可以处理，不限定特定 Core</li>
<li>PPI(Private Peripheral Interrupt)，私有中断，我们说了 GIC 是支持多核的，每个核肯定 有自己独有的中断。这些独有的中断肯定是要指定的核心处理，因此这些中断就叫做私有中断</li>
<li>SGI(Software-generated Interrupt)，软件中断，由软件触发引起的中断，通过向寄存器 GICD_SGIR 写入数据来触发，系统会使用 SGI 中断来完成多核之间的通信</li>
</ol>
<h4 id="中断ID"><a href="#中断ID" class="headerlink" title="中断ID"></a>中断ID</h4><p>中断源有很多，为了区分这些不同的中断源肯定要给他们分配一个唯一 ID，这些 ID 就是 中断 ID。每一个 CPU 最多支持 1020 个中断 ID，中断 ID 号为 ID0~ID1019。这 1020 个 ID 包 含了 PPI、SPI 和 SGI</p>
<ul>
<li><p>1020 个 ID 分 配如下：</p>
<table>
<thead>
<tr>
<th>ID0~ID15</th>
<th>这 16 个 ID 分配给 SG</th>
</tr>
</thead>
<tbody><tr>
<td>ID16~ID31</td>
<td>这 16 个 ID 分配给 PPI</td>
</tr>
<tr>
<td>ID32~ID1019</td>
<td>这 988 个 ID 分配给 SPI，像 GPIO 中断、串口中断等这些外部中断</td>
</tr>
</tbody></table>
</li>
</ul>
<p>I.MX6U 的总共 使用了 128 个中断 ID，加上前面属于 PPI 和 SGI 的 32 个 ID，I.MX6U 的中断源共有 128+32=160 个，这 128 个中断 ID 对应的中断在《I.MX6ULL 参考手册》的“3.2 CortexA7 interrupts”小节</p>
<ul>
<li><p>部分中断源查阅自 《I.MX6ULL 参考手册》</p>
<table>
<thead>
<tr>
<th>IRQ</th>
<th>ID</th>
<th>中断源</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>32</td>
<td>boot</td>
<td>用于在启动异常的时候通知内核</td>
</tr>
<tr>
<td>1</td>
<td>33</td>
<td>ca7_platform</td>
<td>DAP中断，调试端口访问请求中断</td>
</tr>
<tr>
<td>2</td>
<td>34</td>
<td>sdma</td>
<td>SDMA中断</td>
</tr>
<tr>
<td>3</td>
<td>35</td>
<td>tsc</td>
<td>TSC(触摸)中断</td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>snvs_lp_wrapper   snvs_hp_wrapper</td>
<td>SNVS中断</td>
</tr>
<tr>
<td>……</td>
<td>……</td>
<td>……</td>
<td>……</td>
</tr>
<tr>
<td>124</td>
<td>156</td>
<td>无</td>
<td>保留</td>
</tr>
<tr>
<td>125</td>
<td>157</td>
<td>无</td>
<td>保留</td>
</tr>
<tr>
<td>126</td>
<td>158</td>
<td>无</td>
<td>保留</td>
</tr>
<tr>
<td>127</td>
<td>159</td>
<td>pmu</td>
<td>PMU中断</td>
</tr>
</tbody></table>
</li>
</ul>
<h4 id="GIC-逻辑分块"><a href="#GIC-逻辑分块" class="headerlink" title="GIC 逻辑分块"></a>GIC 逻辑分块</h4><p>GIC 架构分为了两个逻辑块：Distributor 和 CPU Interface，也就是分发器端和 CPU 接口端</p>
<ul>
<li><p>Distributor(分发器端)：此逻辑块负责处理各个中断事件的分发问题，也就是中断事件应该发送到哪个 CPU Interface 上去。分发器收集所有的中断源，可以控制每个中断的优先级，它总是将优先级最高的中断事件发送到 CPU 接口端。分发器端要做的主要工作如下：</p>
<ol>
<li>全局中断使能控制</li>
<li>控制每一个中断的使能或者关闭</li>
<li>设置每个中断的优先级</li>
<li>设置每个中断的目标处理器列表</li>
<li>设置每个外部中断的触发模式：电平触发或边沿触发</li>
<li>设置每个中断属于组 0 还是组 1</li>
</ol>
</li>
<li><p>CPU Interface(CPU 接口端)：CPU 接口端是和 CPU Core 相连接的，因此每个 CPU Core 都可以在 GIC 中找到一个与之对应的 CPU Interface。CPU 接口端就是分发器和 CPU Core 之间的桥梁，CPU 接口端主要工作如下： ①、</p>
<ol>
<li>使能或者关闭发送到 CPU Core 的中断请求信号</li>
<li>应答中断</li>
<li>通知中断处理完成</li>
<li>设置优先级掩码，通过掩码来设置哪些中断不需要上报给 CPU Core</li>
<li>定义抢占策略</li>
<li>当多个中断到来的时候，选择优先级最高的中断通知给 CPU Core</li>
</ol>
</li>
</ul>
<p>结构体 GIC_Type 就是 GIC 控制器，列举出了 GIC 控制器的所有寄存器，可以通过结构体 GIC_Type 来访问 GIC 的所有寄存器。GIC 的分发器端相关寄存器，其相对于 GIC 基地址偏移为 0X1000，因此我们获取到 GIC 基地址以后只需要加上 0X1000 即可访问 GIC 分发器端寄存器</p>
<h4 id="CP15-协处理器"><a href="#CP15-协处理器" class="headerlink" title="CP15 协处理器"></a>CP15 协处理器</h4><p>CP15 协处理器一般用于存储系统管理，但是在中断中也会使用到，CP15 协处理器一共有 16 个 32 位寄存器。CP15 协处理器的访问通过如下另个指令完成：</p>
<table>
<thead>
<tr>
<th>MRC</th>
<th>将 CP15 协处理器中的寄存器数据读到 ARM 寄存器中</th>
</tr>
</thead>
<tbody><tr>
<td>MCR</td>
<td>将 ARM 寄存器的数据写入到 CP15 协处理器寄存器中</td>
</tr>
</tbody></table>
<p>MCR 指令格式如下</p>
<p><code>MCR&#123;cond&#125; p15,&lt; opcl &gt;,&lt; Rt &gt;,&lt; CRn &gt;,&lt; CRm &gt;,&lt; opc2 &gt;</code></p>
<table>
<thead>
<tr>
<th>cond</th>
<th>指令执行的条件码，如果忽略的话就表示无条件执行</th>
</tr>
</thead>
<tbody><tr>
<td>opcl</td>
<td>协处理器要执行的操作码</td>
</tr>
<tr>
<td>Rt</td>
<td>ARM 源寄存器，要写入到 CP15 寄存器的数据就保存在此寄存器中</td>
</tr>
<tr>
<td>CRn</td>
<td>CP15 协处理器的目标寄存器</td>
</tr>
<tr>
<td>CRm</td>
<td>协处理器中附加的目标寄存器或者源操作数寄存器，如果不需要附加信息就将 CRm 设置为 C0，否则结果不可预测</td>
</tr>
<tr>
<td>opc2</td>
<td>可选的协处理器特定操作码，当不需要的时候要设置为 0</td>
</tr>
</tbody></table>
<p>MRC 的指令格式和 MCR 一样，只不过在 MRC 指令中 Rt 就是目标寄存器，也就是从 CP15 指定寄存器读出来的数据会保存在 Rt 中。而 CRn 就是源寄存器，也就是要读取的写处 理器寄存器。 假如我们要将 CP15 中 C0 寄存器的值读取到 R0 寄存器中，那么就可以使用如下命令：</p>
<p><code>MRC p15, 0, r0, c0, c0, 0</code></p>
<p>CP15 协处理器有 16 个 32 位寄存器，c0~c15，在使用 MRC 或者 MCR 指令访问这 16 个 寄存器的时候，指令中的 CRn、opc1、CRm 和 opc2 通过不同的搭配，其得到的寄存器含义是 不同的，来看一下 c0、c1、c12 和 c15 这四个寄存器</p>
<h5 id="c0-寄存器"><a href="#c0-寄存器" class="headerlink" title="c0 寄存器"></a>c0 寄存器</h5><p>当 MRC/MCR 指令中的 CRn=c0，opc1=0，CRm=c0，opc2=0 的时候就表示 此时的 c0 就是 MIDR 寄存器，也就是主 ID 寄存器，这个也是 c0 的基本作用。对于 Cortex-A7 内核来说，c0 作为 MDIR 寄存器的时候其含义如图所示：</p>
<p><img src="/Personalwebsite/blog/myBlog/.me//Personalwebsite\blog\myBlog\source_posts\note16-GPIO中断实验实验\image-20210225164458052.png" alt="image-20210225164458052"></p>
<table>
<thead>
<tr>
<th>bit31:24</th>
<th>厂商编号，0X41，ARM</th>
</tr>
</thead>
<tbody><tr>
<td>bit23:20</td>
<td>内核架构的主版本号，ARM 内核版本一般使用 rnpn 来表示，比如 r0p1，其中 r0 后面的 0 就是内核架构主版本号</td>
</tr>
<tr>
<td>bit19:16</td>
<td>架构代码，0XF，ARMv7 架构</td>
</tr>
<tr>
<td>bit15:4</td>
<td>内核版本号，0XC07，Cortex-A7 MPCore 内核</td>
</tr>
<tr>
<td>bit3:0</td>
<td>内核架构的次版本号，rnpn 中的 pn，比如 r0p1 中 p1 后面的 1 就是次版本号</td>
</tr>
</tbody></table>
<h5 id="c1-寄存器"><a href="#c1-寄存器" class="headerlink" title="c1 寄存器"></a>c1 寄存器</h5><p>原理省略</p>
<p>如果要读写 SCTLR 的话，就可以使用如下命令： </p>
<p><code>MRC p15, 0, , c1, c0, 0 ;读取 SCTLR 寄存器，数据保存到 Rt 中</code></p>
<p><code>MCR p15, 0, , c1, c0, 0 ;将 Rt 中的数据写到 SCTLR(c1)寄存器中</code></p>
<h5 id="c12-寄存器"><a href="#c12-寄存器" class="headerlink" title="c12 寄存器"></a>c12 寄存器</h5><p>原理省略</p>
<p>设置 VBAR 为 0X87800000，设置命令如下：</p>
<p> <code>ldr r0, =0X87800000 ; r0=0X87800000</code> </p>
<p><code>MCR p15, 0, r0, c12, c0, 0 ;将 r0 里面的数据写入到 c12 中，即 c12=0X87800000</code></p>
<h5 id="c15-寄存器"><a href="#c15-寄存器" class="headerlink" title="c15 寄存器"></a>c15 寄存器</h5><p>原理省略</p>
<p>获取到 GIC 基地址：</p>
<p> <code>MRC p15, 4, r1, c15, c0, 0 ; 获取 GIC 基础地址，基地址保存在 r1 中</code></p>
<p>获取当前中断 ID 的代码如下： </p>
<p><code>MRC p15, 4, r1, c15, c0, 0 ;获取 GIC 基地址</code> </p>
<p><code>ADD r1, r1, #0X2000 ;GIC 基地址加 0X2000 得到 CPU 接口端寄存器起始地址</code></p>
<p>`LDR r0, [r1, #0XC] ;读取 CPU 接口端起始地址+0XC 处的寄存器值，也就是寄存器 GIC_IAR 的值</p>
<h4 id="中断使能"><a href="#中断使能" class="headerlink" title="中断使能"></a>中断使能</h4><p>中断使能包括两部分，一个是 IRQ 或者 FIQ 总中断使能，另一个就是 ID0~ID1019 这 1020 个中断源的使能</p>
<h5 id="IRQ-和-FIQ-总中断使能"><a href="#IRQ-和-FIQ-总中断使能" class="headerlink" title="IRQ 和 FIQ 总中断使能"></a>IRQ 和 FIQ 总中断使能</h5><table>
<thead>
<tr>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>cpsid i</td>
<td>禁止 IRQ 中断</td>
</tr>
<tr>
<td>cpsie i</td>
<td>使能 IRQ 中断</td>
</tr>
<tr>
<td>cpsid f</td>
<td>禁止 FIQ 中断</td>
</tr>
<tr>
<td>cpsie f</td>
<td>使能 FIQ 中断</td>
</tr>
</tbody></table>
<h5 id="ID0-ID1019-中断使能和禁止"><a href="#ID0-ID1019-中断使能和禁止" class="headerlink" title="ID0~ID1019 中断使能和禁止"></a>ID0~ID1019 中断使能和禁止</h5><p>GIC 寄存器 GICD_ISENABLERn 和 GICD_ ICENABLERn 用来完成外部中断的使能和禁 止，对于 Cortex-A7 内核来说中断 ID 只使用了 512 个。一个 bit 控制一个中断 ID 的使能，那么 就需要 512/32=16 个 GICD_ISENABLER 寄存器来完成中断的使能。同理，也需要 16 个 GICD_ICENABLER 寄存器来完成中断的禁止。其中 GICD_ISENABLER0 的 bit[15:0]对应 ID15<del>0 的 SGI 中断，GICD_ISENABLER0 的 bit[31:16]对应 ID31</del>16 的 PPI 中断。剩下的 GICD_ISENABLER1~GICD_ISENABLER15 就是控制 SPI 中断的</p>
<h4 id="中断优先级设置"><a href="#中断优先级设置" class="headerlink" title="中断优先级设置"></a>中断优先级设置</h4><h5 id="优先级数配置"><a href="#优先级数配置" class="headerlink" title="优先级数配置"></a>优先级数配置</h5><p>Cortex-A7 的中断优先级可以分为抢占优先级和子优先级，Cortex-A7 最多可以支持 256 个优先级，数字越小，优先级越高！I.MX6U 选择了 32 个优先级。在使用中断的时候需要初始化 GICC_PMR 寄存器，此寄存器用来决定使用几级优先级，寄存器结构如图 17.1.6.1 所示</p>
<p><img src="/Personalwebsite/blog/myBlog/.me//Personalwebsite\blog\myBlog\source_posts\note16-GPIO中断实验实验\image-20210225171259807.png" alt="image-20210225171259807"></p>
<p>GICC_PMR 寄存器只有低 8 位有效，这 8 位最多可以设置 256 个优先级，其他优先级数设 置如表 17.1.6.1 所示：</p>
<table>
<thead>
<tr>
<th>bit7:0</th>
<th>优先级数</th>
</tr>
</thead>
<tbody><tr>
<td>11111111</td>
<td>256 个优先级</td>
</tr>
<tr>
<td>11111110</td>
<td>128 个优先级</td>
</tr>
<tr>
<td>11111100</td>
<td>64 个优先级</td>
</tr>
<tr>
<td>11111000</td>
<td>32 个优先级</td>
</tr>
<tr>
<td>11110000</td>
<td>16 个优先级</td>
</tr>
</tbody></table>
<p>I.MX6U 支持 32 个优先级，所以 GICC_PMR 要设置为 0b11111000</p>
<h5 id="抢占优先级和子优先级位数设置"><a href="#抢占优先级和子优先级位数设置" class="headerlink" title="抢占优先级和子优先级位数设置"></a>抢占优先级和子优先级位数设置</h5><p>抢占优先级和子优先级各占多少位是由寄存器 GICC_BPR 来决定的，GICC_BPR 寄存器结构如图</p>
<p><img src="/Personalwebsite/blog/myBlog/.me//Personalwebsite\blog\myBlog\source_posts\note16-GPIO中断实验实验\image-20210225171613112.png" alt="image-20210225171613112"></p>
<p>寄存器 GICC_BPR 只有低 3 位有效，其值不同，抢占优先级和子优先级占用的位数也不同， 配置如表如图：</p>
<table>
<thead>
<tr>
<th>Binary Point</th>
<th>抢占优先级域</th>
<th>子优先级域</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>[7:1]</td>
<td>[0]</td>
<td>7 级抢占优先级，1 级子优先级</td>
</tr>
<tr>
<td>1</td>
<td>[7:2]</td>
<td>[1:0]</td>
<td>6 级抢占优先级，2 级子优先级</td>
</tr>
<tr>
<td>2</td>
<td>[7:3]</td>
<td>[2:0]</td>
<td>5 级抢占优先级，3 级子优先级</td>
</tr>
<tr>
<td>3</td>
<td>[7:4]</td>
<td>[3:0]</td>
<td>4 级抢占优先级，4 级子优先级</td>
</tr>
<tr>
<td>4</td>
<td>[7:5]</td>
<td>[4:0]</td>
<td>3 级抢占优先级，5 级子优先级</td>
</tr>
<tr>
<td>5</td>
<td>[7:6]</td>
<td>[5:0]</td>
<td>2 级抢占优先级，6 级子优先级</td>
</tr>
<tr>
<td>6</td>
<td>[7:7]</td>
<td>[6:0]</td>
<td>1 级抢占优先级，7 级子优先级</td>
</tr>
<tr>
<td>7</td>
<td>无</td>
<td>[7:0]</td>
<td>0 级抢占优先级，8 级子优先级</td>
</tr>
</tbody></table>
<p>为了简单起见，一般将所有的中断优先级位都配置为抢占优先级，比如 I.MX6U 的优先级 位数为 5(32 个优先级)，所以可以设置 Binary point 为 2，表示 5 个优先级位全部为抢占优先级</p>
<h5 id="优先级设置"><a href="#优先级设置" class="headerlink" title="优先级设置"></a>优先级设置</h5><p>某个中断 ID 的中断优先级设置由寄存器 D_IPRIORITYR 来完成，前面说了 Cortex-A7 使用了 512 个中断 ID，每个中断 ID 配有一个优 先级寄存器，所以一共有 512 个 D_IPRIORITYR 寄存器。如果优先级个数为 32 (11111000)的话，使用寄存器 D_IPRIORITYR 的 bit7:4 (第四位开始是1）来设置优先级，也就是说实际的优先级要左移 3 位（把1移过去）。比如要设置 ID40 中断的优先级为 5，示例代码如下：</p>
<p><code>GICD_IPRIORITYR[40] = 5 &lt;&lt; 3;</code></p>
<h5 id="优先级设置主要有三部分："><a href="#优先级设置主要有三部分：" class="headerlink" title="优先级设置主要有三部分："></a>优先级设置主要有三部分：</h5><ol>
<li>设置寄存器 GICC_PMR，配置优先级个数，比如 I.MX6U 支持 32 级优先级</li>
<li>设置抢占优先级和子优先级位数，一般为了简单起见，会将所有的位数都设置为抢占优先级</li>
<li>设置指定中断 ID 的优先级，也就是设置外设优先级</li>
</ol>
<h3 id="中断服务函数"><a href="#中断服务函数" class="headerlink" title="中断服务函数"></a>中断服务函数</h3><p>10个API函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>GIC_Init</td>
<td>初始化 GIC</td>
</tr>
<tr>
<td>GIC_EnableIRQ</td>
<td>使能指定的外设中断</td>
</tr>
<tr>
<td>GIC_DisableIRQ</td>
<td>关闭指定的外设中断</td>
</tr>
<tr>
<td>GIC_AcknowledgeIRQ</td>
<td>返回中断号</td>
</tr>
<tr>
<td>GIC_DeactivateIRQ</td>
<td>无效化指定中断</td>
</tr>
<tr>
<td>GIC_GetRunningPriority</td>
<td>获取当前正在运行的中断优先级</td>
</tr>
<tr>
<td>GIC_SetPriorityGrouping</td>
<td>设置抢占优先级位数</td>
</tr>
<tr>
<td>GIC_GetPriorityGrouping</td>
<td>获取抢占优先级位数</td>
</tr>
<tr>
<td>GIC_SetPriority</td>
<td>设置指定中断的优先级</td>
</tr>
<tr>
<td>GIC_GetPriority</td>
<td>获取指定中断的优先级</td>
</tr>
</tbody></table>
<h3 id="修改start-S"><a href="#修改start-S" class="headerlink" title="修改start.S"></a>修改start.S</h3><p>添加中断向量表，编写复位中断服务函数和IRQ中断服务函数。</p>
<p>编写复位中断服务函数，内容如下：</p>
<ol>
<li>关闭I,D Cache和MMU</li>
<li>设置处理器9中工作模式下对应的SP指针。要使用中断那么必须设置IRQ模式下的SP指针。索性直接设置所有模式下的SP指针</li>
<li>清除bss段</li>
<li>跳到C函数，也就是main函数</li>
</ol>
<h3 id="CP15协处理器"><a href="#CP15协处理器" class="headerlink" title="CP15协处理器"></a>CP15协处理器</h3><p>MRC: 将 CP15 协处理器中的寄存器数据读到 ARM 寄存器中。</p>
<p>MRC 就是读 CP15 寄存器， MCR 就是写 CP15 寄存器， MCR 指令格式如下：</p>
<p>MCR{cond} p15, <opc1>, <Rt>, <CRn>, <CRm>, <opc2></opc2></CRm></CRn></Rt></opc1></p>
<p>MRC p15, 0, r0, c0,c0,0</p>
<p>现在要关闭I,D ache和MMU，打开Cortex-A7参考手册到105页，找到SCTLR寄存器。也就是系统控制寄存器，此寄存器bit0用于打开和关闭MMU，bit1控制对齐，bit2控制D Cache的打开和关闭。Bit11用于控制分支预测。Bit12用于控制I Cache。</p>
<p><strong>中断向量偏移设置</strong></p>
<p>将新的中断向量表首地址写入到CP15协处理器的VBAR寄存器。</p>
<p>MCR{cond} p15, <opc1>, <Rt>, <CRn>, <CRm>, <opc2></opc2></CRm></CRn></Rt></opc1></p>
<p>MRC p15,0,r0,c12,c0,0  </p>
<p>MCR p15,0,r0,c12,c0,0</p>
<p> <strong>IRQ中断服务函数</strong></p>
<p>mrc p15, 4, r1, c15, c0, 0  读取CP15的CBAR寄存器。CBAR寄存器保存了GIC控制器的寄存器组首地址。GIC寄存器组偏移0x1000<del>0x1fff为GIC的分发器。0x2000</del>0x3fff为CPU接口端。意味我们可以访问GIC控制器了！</p>
<p>代码中，R1寄存器吧保存着GIC控制器的CPU接口端基地址。读取CPU接口段的GICC_IAR寄存器的值保存到R0寄存器里面。可以从GICC_IAR的bit9~0读取中断ID，我们读取中断ID的目的就是为了得到对应的中断处理函数</p>
<p>system_irqhandler就是具体的中断处理函数，此函数有一个参数，为GICC_IAR寄存器的值</p>
<p>system_irqhandler处理完具体的中断以后，需要将对应的中断ID值写入到GICC_EOIR寄存器里面</p>
<p>ARM 的指令是三级流水线：取指、译指、执 行，pc 指向的是正在取值的地址，这就是很多书上说的 pc=当前执行指令地址+8</p>
<p><code>0X2000 MOV R1, R0 ;</code></p>
<p><code>执行 0X2004 MOV R2, R3 ;</code></p>
<p><code>译指 0X2008 MOV R4, R5 ;取值 PC</code></p>
<hr>
<p>参考资料：</p>
<p>正点原子【第二期】手把手教你学Linux之ARM（MX6U）裸机篇-GPIO中断实验</p>
<p>正点原子 I.MX6U 嵌入式Linux驱动开发指南 第十七章</p>
<p>《Cortex-A7 Technical ReferenceManua.pdf》</p>
<p>《ARM ArchitectureReference Manual ARMv7-A and ARMv7-R edition.pdf》</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Chenzhan666</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chenzhan666.coding.me/2021/02/21/note16-GPIO%E4%B8%AD%E6%96%AD%E5%AE%9E%E9%AA%8C%E5%AE%9E%E9%AA%8C/">https://chenzhan666.coding.me/2021/02/21/note16-GPIO%E4%B8%AD%E6%96%AD%E5%AE%9E%E9%AA%8C%E5%AE%9E%E9%AA%8C/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chenzhan666.coding.me" target="_blank">CHENZHAN</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/Personalwebsite/blog/myBlog/tags/ARM-MX6U/">ARM(MX6U)</a></div><div class="post_share"><div class="social-share" data-image="https://i0.hdslb.com/bfs/album/c2e54c69fd83a318261e5b30e13bc8184caf837f.jpg@518w.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Personalwebsite/blog/myBlog/2021/02/26/note17-EPIT%E5%AE%9A%E6%97%B6%E5%99%A8%E5%AE%9E%E9%AA%8C/"><img class="prev-cover" src="https://i0.hdslb.com/bfs/album/d186bc9ebd6166a0702afc3be8aced74148845b1.png@518w.png" onerror="onerror=null;src='/Personalwebsite/blog/myBlog/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">note17-EPIT定时器，按键消抖，高精度延时</div></div></a></div><div class="next-post pull-right"><a href="/Personalwebsite/blog/myBlog/2021/02/20/note15-%E4%B8%BB%E9%A2%91%E5%92%8C%E6%97%B6%E9%92%9F%E9%85%8D%E7%BD%AE%E5%AE%9E%E9%AA%8C/"><img class="next-cover" src="https://i0.hdslb.com/bfs/article/c045ee3a7675559c95272fd8865fd7161ae05549.jpg@1320w_742h.webp" onerror="onerror=null;src='/Personalwebsite/blog/myBlog/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">note15 主频和时钟配置实验</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Personalwebsite/blog/myBlog/2021/02/14/note10-I-MX6U启动方式/" title="note10 I.MX6U启动方式"><img class="cover" src="https://i0.hdslb.com/bfs/article/c1f5404dfc142af3c96d83a1a37b4f32b3f84fef.jpg@1320w_934h.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-14</div><div class="title">note10 I.MX6U启动方式</div></div></a></div><div><a href="/Personalwebsite/blog/myBlog/2021/02/15/note13-蜂鸣器实验/" title="note13 蜂鸣器实验"><img class="cover" src="https://i0.hdslb.com/bfs/album/d9169dc108ec1dc6c330a5472858de36759703a5.jpg@518w.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-15</div><div class="title">note13 蜂鸣器实验</div></div></a></div><div><a href="/Personalwebsite/blog/myBlog/2021/02/20/note15-主频和时钟配置实验/" title="note15 主频和时钟配置实验"><img class="cover" src="https://i0.hdslb.com/bfs/article/c045ee3a7675559c95272fd8865fd7161ae05549.jpg@1320w_742h.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-20</div><div class="title">note15 主频和时钟配置实验</div></div></a></div><div><a href="/Personalwebsite/blog/myBlog/2021/02/17/note14-GPIO输入按键实验/" title="note14 GPIO输入按键实验"><img class="cover" src="https://i0.hdslb.com/bfs/album/aee4ce6332eff5bdc8c9ec4ce19c1d606c156d7f.jpg@518w.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-17</div><div class="title">note14 GPIO输入按键实验</div></div></a></div><div><a href="/Personalwebsite/blog/myBlog/2021/02/26/note17-EPIT定时器实验/" title="note17-EPIT定时器，按键消抖，高精度延时"><img class="cover" src="https://i0.hdslb.com/bfs/album/d186bc9ebd6166a0702afc3be8aced74148845b1.png@518w.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-26</div><div class="title">note17-EPIT定时器，按键消抖，高精度延时</div></div></a></div><div><a href="/Personalwebsite/blog/myBlog/2021/02/27/note18-UART串口通信/" title="note18-UART串口通信"><img class="cover" src="https://i0.hdslb.com/bfs/article/0efc347b8b2fab3bbc38b50abf506085c2aa185d.jpg@1200w_688h.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-27</div><div class="title">note18-UART串口通信</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/Personalwebsite/blog/myBlog/null" onerror="this.onerror=null;this.src='/Personalwebsite/blog/myBlog/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Chenzhan666</div><div class="author-info__description">演好你的剧本( ´･ω･)ﾉ(._.`)</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/Personalwebsite/blog/myBlog/archives/"><div class="headline">文章</div><div class="length-num">26</div></a></div><div class="card-info-data-item is-center"><a href="/Personalwebsite/blog/myBlog/tags/"><div class="headline">标签</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Cortex-A7-%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">Cortex-A7 中断系统详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E5%90%91%E9%87%8F%E8%A1%A8"><span class="toc-number">1.1.1.</span> <span class="toc-text">中断向量表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E5%90%91%E9%87%8F%E5%81%8F%E7%A7%BB"><span class="toc-number">1.1.2.</span> <span class="toc-text">中断向量偏移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GIC-%E5%86%85%E5%B5%8C%E5%90%91%E9%87%8F%E4%B8%AD%E6%96%AD%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">1.1.3.</span> <span class="toc-text">GIC(内嵌向量中断控制器)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%ADID"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">中断ID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GIC-%E9%80%BB%E8%BE%91%E5%88%86%E5%9D%97"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">GIC 逻辑分块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CP15-%E5%8D%8F%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">CP15 协处理器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#c0-%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.3.3.1.</span> <span class="toc-text">c0 寄存器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c1-%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.3.3.2.</span> <span class="toc-text">c1 寄存器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c12-%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.3.3.3.</span> <span class="toc-text">c12 寄存器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c15-%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.3.3.4.</span> <span class="toc-text">c15 寄存器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E4%BD%BF%E8%83%BD"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">中断使能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IRQ-%E5%92%8C-FIQ-%E6%80%BB%E4%B8%AD%E6%96%AD%E4%BD%BF%E8%83%BD"><span class="toc-number">1.1.3.4.1.</span> <span class="toc-text">IRQ 和 FIQ 总中断使能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ID0-ID1019-%E4%B8%AD%E6%96%AD%E4%BD%BF%E8%83%BD%E5%92%8C%E7%A6%81%E6%AD%A2"><span class="toc-number">1.1.3.4.2.</span> <span class="toc-text">ID0~ID1019 中断使能和禁止</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E7%BA%A7%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.1.3.5.</span> <span class="toc-text">中断优先级设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.3.5.1.</span> <span class="toc-text">优先级数配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%A2%E5%8D%A0%E4%BC%98%E5%85%88%E7%BA%A7%E5%92%8C%E5%AD%90%E4%BC%98%E5%85%88%E7%BA%A7%E4%BD%8D%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.1.3.5.2.</span> <span class="toc-text">抢占优先级和子优先级位数设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.1.3.5.3.</span> <span class="toc-text">优先级设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E8%AE%BE%E7%BD%AE%E4%B8%BB%E8%A6%81%E6%9C%89%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A"><span class="toc-number">1.1.3.5.4.</span> <span class="toc-text">优先级设置主要有三部分：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E6%9C%8D%E5%8A%A1%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.4.</span> <span class="toc-text">中断服务函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9start-S"><span class="toc-number">1.1.5.</span> <span class="toc-text">修改start.S</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CP15%E5%8D%8F%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.1.6.</span> <span class="toc-text">CP15协处理器</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Personalwebsite/blog/myBlog/2021/03/05/note25-LCD%E8%83%8C%E5%85%89%E8%B0%83%E8%8A%82/" title="note25-LCD背光调节"><img src="https://i0.hdslb.com/bfs/article/d8c27357c95b4ec212391f814a276990815f09e1.jpg@1320w_734h.webp" onerror="this.onerror=null;this.src='/Personalwebsite/blog/myBlog/img/404.jpg'" alt="note25-LCD背光调节"/></a><div class="content"><a class="title" href="/Personalwebsite/blog/myBlog/2021/03/05/note25-LCD%E8%83%8C%E5%85%89%E8%B0%83%E8%8A%82/" title="note25-LCD背光调节">note25-LCD背光调节</a><time datetime="2021-03-05T14:40:09.000Z" title="发表于 2021-03-05 22:40:09">2021-03-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Personalwebsite/blog/myBlog/2021/03/05/note24-%E5%A4%9A%E7%82%B9%E7%94%B5%E5%AE%B9%E8%A7%A6%E6%91%B8%E5%B1%8F/" title="note24-多点电容触摸屏"><img src="https://i0.hdslb.com/bfs/article/6df5035bad4239b717df0b5bc957b81f1e4e1fad.jpg@1320w_854h.webp" onerror="this.onerror=null;this.src='/Personalwebsite/blog/myBlog/img/404.jpg'" alt="note24-多点电容触摸屏"/></a><div class="content"><a class="title" href="/Personalwebsite/blog/myBlog/2021/03/05/note24-%E5%A4%9A%E7%82%B9%E7%94%B5%E5%AE%B9%E8%A7%A6%E6%91%B8%E5%B1%8F/" title="note24-多点电容触摸屏">note24-多点电容触摸屏</a><time datetime="2021-03-05T12:47:55.000Z" title="发表于 2021-03-05 20:47:55">2021-03-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Personalwebsite/blog/myBlog/2021/03/03/note23-SPI%E5%AE%9E%E9%AA%8C/" title="note23-SPI实验"><img src="https://i0.hdslb.com/bfs/article/a1afb00e2f3048d34143eb987c7a0a15d41e8bfe.jpg@1320w_932h.webp" onerror="this.onerror=null;this.src='/Personalwebsite/blog/myBlog/img/404.jpg'" alt="note23-SPI实验"/></a><div class="content"><a class="title" href="/Personalwebsite/blog/myBlog/2021/03/03/note23-SPI%E5%AE%9E%E9%AA%8C/" title="note23-SPI实验">note23-SPI实验</a><time datetime="2021-03-03T13:08:21.000Z" title="发表于 2021-03-03 21:08:21">2021-03-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Personalwebsite/blog/myBlog/2021/03/02/note22-I2C%E5%AE%9E%E9%AA%8C/" title="note22-I2C实验"><img src="https://i0.hdslb.com/bfs/article/3a2fd9570279ce3cffb3894ee9943ea52eec3281.jpg@1320w_742h.webp" onerror="this.onerror=null;this.src='/Personalwebsite/blog/myBlog/img/404.jpg'" alt="note22-I2C实验"/></a><div class="content"><a class="title" href="/Personalwebsite/blog/myBlog/2021/03/02/note22-I2C%E5%AE%9E%E9%AA%8C/" title="note22-I2C实验">note22-I2C实验</a><time datetime="2021-03-01T16:40:54.000Z" title="发表于 2021-03-02 00:40:54">2021-03-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Personalwebsite/blog/myBlog/2021/03/01/note21-RTC%E5%AE%9E%E6%97%B6%E6%97%B6%E9%92%9F/" title="note21-RTC实时时钟"><img src="https://i0.hdslb.com/bfs/article/27bdacd1e9a5defa72cab581e643da8d54a5a005.jpg@1320w_928h.webp" onerror="this.onerror=null;this.src='/Personalwebsite/blog/myBlog/img/404.jpg'" alt="note21-RTC实时时钟"/></a><div class="content"><a class="title" href="/Personalwebsite/blog/myBlog/2021/03/01/note21-RTC%E5%AE%9E%E6%97%B6%E6%97%B6%E9%92%9F/" title="note21-RTC实时时钟">note21-RTC实时时钟</a><time datetime="2021-03-01T06:52:25.000Z" title="发表于 2021-03-01 14:52:25">2021-03-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Chenzhan666</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/Personalwebsite/blog/myBlog/js/utils.js"></script><script src="/Personalwebsite/blog/myBlog/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/Personalwebsite/blog/myBlog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-hibiki"},"display":{"position":"right","width":145,"height":315},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body></html>